#include <Arduino.h>
#include <Ticker.h>
#include <Wire.h>
#include <DS1621.h>

/*  -----------------------------------------------------------------------  const ------------------------------------------------------------- */
/* +++++++++++++++++++++++++++++++++++++++++++++++++++  A_ pour adresse , R_ pour registre ++++++++++++++++++++++++++++++++++++++++++++++++++++ */
const uint8_t LED_PIN = 13;
const uint8_t A_DS1621 = 0x49; // adresse I2C du capteur
void action();

/*  -----------------------------------------------------------------------  objets ------------------------------------------------------------- */
Ticker mticker(action, 2000, 0, MILLIS);
/*  .........................  Capteur DS1621 ...................... */
DS1621 cap_ds1621;
/* ...................................DS3231 ........................*/

/*  --------------------------------------------------------------  variable globale ------------------------------------------------------------- */

/*  *********************************************************************  Action **************************************************************** */
void action()
{
  cap_ds1621.startConv();
  float temp = cap_ds1621.getTemperature();

  Serial.print("temp = ");
  Serial.println(temp);
}

/*  ____________________________________________  SETUP _____________________________________________________ */
void setup()
{
  //
  Serial.begin(115200);
  pinMode(LED_PIN, OUTPUT);
  digitalWrite(LED_PIN, 0);

  // init ds1621
  bool res = cap_ds1621.begin(A_DS1621);
  if (res == false)
  {
    Serial.println("ERROR");
  }
  else
  {
    Serial.println("pret");
    mticker.start();
  }
}
/*  ____________________________________________  LOOP ______________________________________________________ */
void loop()
{
  mticker.update();
}
